#!/usr/bin/env ruby

require "tty-prompt"

require_relative "db"
require_relative "initializer"

@db = DB.new
@prompt = TTY::Prompt.new

def start
  name = @prompt.ask("Name:")
  now = Time.now
  @db.start(
    id: now.hash,
    type: "start",
    reference: nil,
    timestamp: now,
    name: name
  )
end

def stop
  activity = @prompt.select("Select activity", @db.active, filter: true)
  @db.stop(activity)
end

case ARGV.first
when nil
	# default
	exit
when "init"
  Initializer.init
	exit
when "start"
	start
	exit
when "stop"
  stop
  exit
else
	puts "tt: command not found: #{ARGV.first}"
	exit 1
end


#!/usr/bin/env ruby

require "tty-prompt"
require "tty-table"

require_relative "db"
require_relative "initializer"

@db = DB.new
@prompt = TTY::Prompt.new

def start(name = "")
  name = @prompt.ask("Name:") if name.nil?
  now = Time.now
  @db.start(
    id: now.hash,
    type: "start",
    reference: nil,
    timestamp: now,
    name: name
  )
end

def stop
  activity = @prompt.select("Select activity", @db.active_names, filter: true)
  @db.stop(activity)
end

def show_active
  active = @db.active
  table = TTY::Table.new(["Name", "Started"], active)
  puts table.render(:unicode)
end

case ARGV.first
when nil
  # default
  exit
when "active"
  show_active
  exit
when "init"
  Initializer.init
  exit
when "start"
  start(ARGV[1])
  exit
when "stop"
  stop
  exit
else
  puts "tt: command not found: #{ARGV.first}"
  exit 1
end

